<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .drop-zone {
            border: 2px dashed #007bff;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            position: relative;
            overflow: hidden;
        }

        .drop-zone:hover {
            border-color: #0056b3;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
        }

        .drop-zone.drag-over {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        .drop-zone-content {
            position: relative;
            z-index: 2;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .drop-zone:hover::before {
            left: 100%;
        }

        .file-preview {
            position: relative;
            display: inline-block;
            margin: 5px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .file-preview:hover {
            transform: scale(1.05);
        }

        .file-preview img {
            width: 120px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
        }

        .file-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .file-remove:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .file-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 5px;
            font-size: 10px;
            text-align: center;
        }

        .upload-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: #28a745;
            transition: width 0.3s ease;
        }

        .drop-zone-icon {
            font-size: 3rem;
            color: #007bff;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .drop-zone:hover .drop-zone-icon {
            color: #0056b3;
            transform: scale(1.1);
        }

        .drop-zone.drag-over .drop-zone-icon {
            color: #28a745;
            animation: bounce 0.6s ease infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .file-type-indicator {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            text-transform: uppercase;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: #28a745;
            font-size: 0.875rem;
            margin-top: 10px;
            display: none;
        }

        .nav-tabs .nav-link {
            color: #495057;
            border: none;
            border-bottom: 2px solid transparent;
            background: none;
        }

        .nav-tabs .nav-link.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: none;
        }

        .nav-tabs .nav-link:hover {
            border-bottom-color: #007bff;
            background: none;
        }

        .settings-section {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .settings-section h5 {
            color: #495057;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .form-switch .form-check-input {
            width: 3rem;
            height: 1.5rem;
        }

        .notification-template-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f8f9fa;
        }

        .notification-template-item:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .time-input-wrapper {
            position: relative;
        }

        .time-input-wrapper .form-text {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .module-toggle {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .module-toggle:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }

        .module-toggle.disabled {
            background: #f8f9fa;
            opacity: 0.7;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1060;
        }

        .timezone-preview {
            background: #e9ecef;
            border-radius: 4px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }

        .notification-preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .settings-section {
                padding: 1rem;
            }

            .module-toggle {
                padding: 0.75rem;
            }

            .notification-template-item {
                padding: 0.75rem;
            }
        }
    </style>
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container mt-4">
        <div class="d-flex align-items-center mb-4">
            <h3 class="mb-0 flex-grow-1">Hotel Management System</h3>
            <button class="btn btn-primary" onclick="showAddHotel()">
                <i class="fas fa-plus"></i> Add Hotel
            </button>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="hotels-tab" data-bs-toggle="tab" data-bs-target="#hotels"
                    type="button" role="tab" aria-controls="hotels" aria-selected="true">
                    <i class="fas fa-hotel me-2"></i>Hotels
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button"
                    role="tab" aria-controls="settings" aria-selected="false">
                    <i class="fas fa-cog me-2"></i>System Settings
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Hotels Tab -->
            <div class="tab-pane fade show active" id="hotels" role="tabpanel" aria-labelledby="hotels-tab">
                <!-- Table Section -->
                <div id="hotelTableWrapper">
                    <div class="card">
                        <div class="card-body">
                            <table class="table table-bordered table-striped">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Name</th>
                                        <th>Address</th>
                                        <th>Location</th>
                                        <th>Phone</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="hotelTableBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Form Section -->
                <div id="hotelFormWrapper" style="display:none;">
                    <div class="card">
                        <div class="card-body">
                            <form id="hotelForm" onsubmit="return saveHotelForm(event)">
                                <h5 class="mb-3" id="hotelFormTitle">Edit Hotel</h5>
                                <input type="hidden" id="hotelIndex">

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="hotelName" class="form-label">Name *</label>
                                        <input type="text" class="form-control" id="hotelName" required
                                            aria-describedby="hotelNameHelp">
                                        <div id="hotelNameHelp" class="form-text">Enter the official hotel name</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="hotelPhone" class="form-label">Phone Number *</label>
                                        <input type="tel" pattern="\+?[0-9]{7,15}" class="form-control" id="hotelPhone"
                                            placeholder="+94771234567" required aria-describedby="hotelPhoneHelp">
                                        <div id="hotelPhoneHelp" class="form-text">Include country code (e.g.,
                                            +94771234567)</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="hotelAddress" class="form-label">Address *</label>
                                        <input type="text" class="form-control" id="hotelAddress" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="hotelLocation" class="form-label">Location *</label>
                                        <input type="text" class="form-control" id="hotelLocation" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="hotelDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="hotelDescription" rows="3"
                                        aria-describedby="hotelDescriptionHelp"></textarea>
                                    <div id="hotelDescriptionHelp" class="form-text">Brief description of the hotel and
                                        its amenities</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Images (Max 3 - JPG, PNG, GIF up to 5MB each)</label>
                                    <div id="dropZone" class="drop-zone" role="button" tabindex="0"
                                        aria-label="Click or drag files to upload images">
                                        <div class="drop-zone-content">
                                            <i class="fas fa-cloud-upload-alt drop-zone-icon"></i>
                                            <div class="h5 mb-2">Drag & Drop Images Here</div>
                                            <div class="text-muted mb-3">or click to browse files</div>
                                            <button type="button" class="btn btn-outline-primary btn-sm">
                                                <i class="fas fa-folder-open"></i> Choose Files
                                            </button>
                                        </div>
                                        <input type="file" id="hotelImages" multiple accept="image/*"
                                            style="display:none;" aria-label="Upload hotel images">
                                    </div>
                                    <div class="error-message" id="errorMessage" role="alert"></div>
                                    <div class="success-message" id="successMessage" role="alert"></div>
                                    <div id="preview" class="d-flex flex-wrap mt-3"></div>
                                </div>

                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-danger" onclick="deleteHotel()">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="hideHotelForm()">
                                        <i class="fas fa-arrow-left"></i> Back
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <!-- Daily Cutoff Settings -->
                <div class="settings-section">
                    <h5><i class="fas fa-clock me-2"></i>Daily Operations</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="ccCutoffTime" class="form-label">Daily Credit-Card Detail Cutoff Time *</label>
                            <div class="time-input-wrapper">
                                <input type="time" class="form-control" id="ccCutoffTime" value="19:00"
                                    aria-describedby="ccCutoffHelp" required>
                                <div id="ccCutoffHelp" class="form-text">
                                    Reservations without credit-card details will auto-cancel at this time each day
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="timezone" class="form-label">Hotel Time Zone *</label>
                            <select class="form-select" id="timezone" aria-describedby="timezoneHelp" required>
                                <option value="Asia/Colombo" selected>Asia/Colombo (Sri Lanka)</option>
                                <option value="America/New_York">America/New_York (EST)</option>
                                <option value="America/Los_Angeles">America/Los_Angeles (PST)</option>
                                <option value="Europe/London">Europe/London (GMT)</option>
                                <option value="Europe/Paris">Europe/Paris (CET)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
                                <option value="Australia/Sydney">Australia/Sydney (AEDT)</option>
                                <option value="Pacific/Auckland">Pacific/Auckland (NZDT)</option>
                            </select>
                            <div id="timezoneHelp" class="form-text">All scheduled processes will run in this time zone
                            </div>
                            <div id="timezonePreview" class="timezone-preview"></div>
                        </div>
                    </div>
                </div>

                <!-- Module Management -->
                <div class="settings-section">
                    <h5><i class="fas fa-puzzle-piece me-2"></i>Module Management</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-plane me-2 text-primary"></i>Travel-Agency
                                            Booking</h6>
                                        <small class="text-muted">Enable bookings through travel agency partners</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="travelAgencyModule" checked
                                            aria-label="Enable Travel-Agency Booking">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-utensils me-2 text-success"></i>Restaurant
                                            Extras</h6>
                                        <small class="text-muted">Allow guests to order restaurant services</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="restaurantModule" checked
                                            aria-label="Enable Restaurant Extras">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-tshirt me-2 text-info"></i>Laundry Services
                                        </h6>
                                        <small class="text-muted">Provide laundry and dry cleaning services</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="laundryModule"
                                            aria-label="Enable Laundry Services">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-envelope me-2 text-warning"></i>Automated
                                            Email/SMS Notifications</h6>
                                        <small class="text-muted">Send automatic notifications to guests</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="notificationModule" checked
                                            aria-label="Enable Automated Notifications">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-chart-line me-2 text-danger"></i>Analytics &
                                            Reporting</h6>
                                        <small class="text-muted">Advanced analytics and business intelligence</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="analyticsModule" checked
                                            aria-label="Enable Analytics & Reporting">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="module-toggle">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-mobile-alt me-2 text-secondary"></i>Mobile
                                            Check-in/out</h6>
                                        <small class="text-muted">Allow guests to check-in/out via mobile app</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="mobileModule"
                                            aria-label="Enable Mobile Check-in/out">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Template Management -->
                <div class="settings-section">
                    <h5><i class="fas fa-bell me-2"></i>Notification Templates</h5>
                    <div class="row">
                        <div class="col-12">
                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-check-circle text-success me-2"></i>Booking
                                            Confirmation</h6>
                                        <small class="text-muted">Sent when a booking is confirmed</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('booking-confirmation')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('booking-confirmation')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('booking-confirmation')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-clock text-warning me-2"></i>Payment Reminder
                                        </h6>
                                        <small class="text-muted">Sent for pending payments</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('payment-reminder')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('payment-reminder')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('payment-reminder')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-calendar text-info me-2"></i>Check-in Reminder
                                        </h6>
                                        <small class="text-muted">Sent 24 hours before check-in</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('checkin-reminder')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('checkin-reminder')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('checkin-reminder')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-edit text-primary me-2"></i>Modification
                                            Confirmation</h6>
                                        <small class="text-muted">Sent when booking is modified</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('modification-confirmation')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('modification-confirmation')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('modification-confirmation')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i
                                                class="fas fa-times-circle text-danger me-2"></i>Cancellation
                                            Confirmation</h6>
                                        <small class="text-muted">Sent when booking is cancelled</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('cancellation-confirmation')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('cancellation-confirmation')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('cancellation-confirmation')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="notification-template-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-star text-warning me-2"></i>Feedback Request
                                        </h6>
                                        <small class="text-muted">Sent after check-out</small>
                                    </div>
                                    <div class="btn-group" role="group" aria-label="Template actions">
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                            onclick="previewTemplate('feedback-request')">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="editTemplate('feedback-request')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="testSendTemplate('feedback-request')">
                                            <i class="fas fa-paper-plane"></i> Test
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Settings -->
                <div class="d-flex justify-content-end gap-2 mt-4">
                    <button type="button" class="btn btn-outline-secondary" onclick="resetSettings()">
                        <i class="fas fa-undo"></i> Reset to Defaults
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save All Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Preview Modal -->
    <div class="modal fade" id="templatePreviewModal" tabindex="-1" aria-labelledby="templatePreviewModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templatePreviewModalLabel">Template Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="templatePreviewContent" class="notification-preview">
                        <!-- Template preview will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Editor Modal -->
    <div class="modal fade" id="templateEditorModal" tabindex="-1" aria-labelledby="templateEditorModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templateEditorModalLabel">Edit Template</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <form id="templateEditForm">
                                <input type="hidden" id="editingTemplateType">

                                <div class="mb-3">
                                    <label for="templateSubject" class="form-label">Email Subject *</label>
                                    <input type="text" class="form-control" id="templateSubject" required>
                                </div>

                                <div class="mb-3">
                                    <label for="templateEmailContent" class="form-label">Email Content *</label>
                                    <textarea class="form-control" id="templateEmailContent" rows="12"
                                        required></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="templateSmsContent" class="form-label">SMS Content</label>
                                    <textarea class="form-control" id="templateSmsContent" rows="3"
                                        placeholder="SMS message (optional)" maxlength="160"></textarea>
                                    <div class="form-text">Maximum 160 characters for SMS</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Available Variables</label>
                                    <div class="d-flex flex-wrap gap-1">
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{guestName}}')">Guest Name</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{bookingRef}}')">Booking Ref</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{roomType}}')">Room Type</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{checkinDate}}')">Check-in Date</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{checkoutDate}}')">Check-out Date</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary"
                                            onclick="insertVariable('{{totalAmount}}')">Total Amount</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Live Preview</label>
                            <div id="templateLivePreview" class="notification-preview" style="height: 400px;">
                                <!-- Live preview will be updated here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTemplateChanges()">Save Template</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let hotels = [
            { name: 'Grand Plaza', address: '123 Main St', location: 'Colombo', phone: '+94771234567', description: 'Luxury hotel near beach', images: [] },
            { name: 'City Inn', address: '45 Market Rd', location: 'Kandy', phone: '+94779876543', description: 'Cozy city center inn', images: [] },
            { name: 'Mountain Retreat', address: '88 Hilltop Ave', location: 'Nuwara Eliya', phone: '+94770011223', description: 'Scenic mountain views', images: [] },
            { name: 'Lakeview Resort', address: '12 Lake St', location: 'Koggala', phone: '+94771122334', description: 'Resort by the lake', images: [] },
            { name: 'Forest Hideaway', address: '77 Green Way', location: 'Sinharaja', phone: '+94772233445', description: 'Jungle bungalow experience', images: [] },
            { name: 'Beachside Bungalow', address: '5 Palm Dr', location: 'Bentota', phone: '+94773344556', description: 'Private beach bungalows', images: [] },
            { name: 'Heritage Hotel', address: '9 Queen St', location: 'Galle', phone: '+94774455667', description: 'Colonial style hotel', images: [] },
            { name: 'Safari Lodge', address: '34 Wild Rd', location: 'Yala', phone: '+94775566778', description: 'Wildlife safari lodge', images: [] },
            { name: 'Eco Green', address: '22 Bamboo Ln', location: 'Ella', phone: '+94776677889', description: 'Eco-friendly retreat', images: [] },
            { name: 'Royal Suites', address: '100 King St', location: 'Nuwara Eliya', phone: '+94777788990', description: 'Premium suite experience', images: [] }
        ];

        let selectedFiles = [];
        const maxFiles = 3;
        const maxFileSize = 5 * 1024 * 1024; // 5MB
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];

        // Email templates from the confirmation system
        const emailTemplates = {
            'booking-confirmation': {
                subject: 'Booking Confirmation - Real Nest',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>Your booking has been confirmed!</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>Thank you for choosing Real Nest! We're delighted to confirm your reservation.</p>
                    <div class="booking-details-table">
                        <h5><i class="fas fa-info-circle"></i> Booking Details</h5>
                        <table style="width: 100%; margin-top: 1rem;">
                            <tr><td><strong>Booking Reference:</strong></td><td>{{bookingRef}}</td></tr>
                            <tr><td><strong>Room Type:</strong></td><td>{{roomType}}</td></tr>
                            <tr><td><strong>Check-in:</strong></td><td>{{checkinDate}}</td></tr>
                            <tr><td><strong>Check-out:</strong></td><td>{{checkoutDate}}</td></tr>
                            <tr><td><strong>Total Amount:</strong></td><td><strong>{{totalAmount}}</strong></td></tr>
                        </table>
                    </div>
                </div>`,
                smsContent: 'Booking confirmed! Reference: {{bookingRef}}. Check-in: {{checkinDate}}. See email for details.'
            },
            'payment-reminder': {
                subject: 'Payment Reminder - Booking {{bookingRef}}',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>Payment Reminder</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>This is a friendly reminder that payment for your booking is still pending.</p>
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                        <h5><i class="fas fa-exclamation-triangle text-warning"></i> Payment Required</h5>
                        <p><strong>Booking Reference:</strong> {{bookingRef}}<br>
                        <strong>Amount Due:</strong> {{totalAmount}}<br>
                        <strong>Payment Deadline:</strong> Today at 7:00 PM</p>
                    </div>
                </div>`,
                smsContent: 'Payment reminder: {{totalAmount}} due for booking {{bookingRef}}. Pay by 7PM to secure reservation.'
            },
            'checkin-reminder': {
                subject: 'Check-in Reminder - Tomorrow at Real Nest',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>Your stay begins tomorrow!</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>We're excited to welcome you to Real Nest tomorrow!</p>
                    <div class="booking-details-table">
                        <h5><i class="fas fa-calendar-check"></i> Your Arrival Details</h5>
                        <table style="width: 100%; margin-top: 1rem;">
                            <tr><td><strong>Check-in Date:</strong></td><td>{{checkinDate}}</td></tr>
                            <tr><td><strong>Room Type:</strong></td><td>{{roomType}}</td></tr>
                            <tr><td><strong>Booking Reference:</strong></td><td>{{bookingRef}}</td></tr>
                        </table>
                    </div>
                </div>`,
                smsContent: 'Check-in reminder: Tomorrow {{checkinDate}} at Real Nest. Ref: {{bookingRef}}. Bring ID!'
            },
            'modification-confirmation': {
                subject: 'Booking Modified - {{bookingRef}}',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>Booking modification confirmed</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>Your booking modification has been successfully processed.</p>
                    <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                        <h5><i class="fas fa-edit"></i> Updated Booking Details</h5>
                        <table style="width: 100%; margin-top: 1rem;">
                            <tr><td><strong>Booking Reference:</strong></td><td>{{bookingRef}}</td></tr>
                            <tr><td><strong>New Check-in:</strong></td><td>{{checkinDate}}</td></tr>
                            <tr><td><strong>New Check-out:</strong></td><td>{{checkoutDate}}</td></tr>
                            <tr><td><strong>Updated Total:</strong></td><td><strong>{{totalAmount}}</strong></td></tr>
                        </table>
                    </div>
                </div>`,
                smsContent: 'Booking {{bookingRef}} modified. New dates: {{checkinDate}} to {{checkoutDate}}. Total: {{totalAmount}}'
            },
            'cancellation-confirmation': {
                subject: 'Booking Cancelled - {{bookingRef}}',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>Booking cancellation confirmed</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>We've successfully cancelled your booking as requested.</p>
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                        <h5><i class="fas fa-times-circle"></i> Cancelled Booking</h5>
                        <p><strong>Booking Reference:</strong> {{bookingRef}}<br>
                        <strong>Refund Amount:</strong> {{totalAmount}}<br>
                        <strong>Refund Timeline:</strong> 5-7 business days</p>
                    </div>
                </div>`,
                smsContent: 'Booking {{bookingRef}} cancelled. Refund {{totalAmount}} in 5-7 business days.'
            },
            'feedback-request': {
                subject: 'How was your stay at Real Nest?',
                emailContent: `<div class="email-header">
                    <h1><i class="fas fa-hotel"></i> Real Nest</h1>
                    <p>We hope you enjoyed your stay!</p>
                </div>
                <div class="email-content">
                    <h3>Dear {{guestName}},</h3>
                    <p>Thank you for choosing Real Nest for your recent stay. We hope you had a wonderful experience!</p>
                    <div style="text-align: center; background: #f8f9fa; border-radius: 8px; padding: 2rem; margin: 2rem 0;">
                        <h5>Rate Your Experience</h5>
                        <div style="font-size: 2rem; margin: 1rem 0;"></div>
                        <a href="#" style="background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px;">Leave a Review</a>
                    </div>
                </div>`,
                smsContent: 'How was your stay at Real Nest? Please rate us and leave a review. Thank you!'
            }
        };

        // System settings
        let systemSettings = {
            ccCutoffTime: '19:00',
            timezone: 'Asia/Colombo',
            modules: {
                travelAgency: true,
                restaurant: true,
                laundry: false,
                notifications: true,
                analytics: true,
                mobile: false
            }
        };

        document.addEventListener('DOMContentLoaded', function () {
            loadHotels();
            initializeDragAndDrop();
            initializeSettings();
            updateTimezonePreview();
        });

        function loadHotels() {
            const tbody = document.getElementById('hotelTableBody');
            tbody.innerHTML = '';
            hotels.forEach((h, i) => {
                tbody.insertAdjacentHTML('beforeend', `
                <tr data-index="${i}">
                    <td>${h.name}</td>
                    <td>${h.address}</td>
                    <td>${h.location}</td>
                    <td>${h.phone}</td>
                    <td><button class="btn btn-outline-primary btn-sm" onclick="showHotelForm(${i})" aria-label="Edit ${h.name}"><i class="fas fa-pencil-alt"></i></button></td>
                </tr>
            `);
            });
        }

        function initializeSettings() {
            // Load current settings
            document.getElementById('ccCutoffTime').value = systemSettings.ccCutoffTime;
            document.getElementById('timezone').value = systemSettings.timezone;

            // Load module states
            Object.keys(systemSettings.modules).forEach(module => {
                const checkbox = document.getElementById(module + 'Module');
                if (checkbox) {
                    checkbox.checked = systemSettings.modules[module];
                    updateModuleState(module, systemSettings.modules[module]);
                }
            });

            // Add event listeners for module toggles
            Object.keys(systemSettings.modules).forEach(module => {
                const checkbox = document.getElementById(module + 'Module');
                if (checkbox) {
                    checkbox.addEventListener('change', function () {
                        updateModuleState(module, this.checked);
                        systemSettings.modules[module] = this.checked;
                    });
                }
            });

            // Add timezone change listener
            document.getElementById('timezone').addEventListener('change', updateTimezonePreview);
        }

        function updateModuleState(module, enabled) {
            const moduleToggle = document.getElementById(module + 'Module').closest('.module-toggle');
            if (enabled) {
                moduleToggle.classList.remove('disabled');
            } else {
                moduleToggle.classList.add('disabled');
            }
        }

        function updateTimezonePreview() {
            const timezone = document.getElementById('timezone').value;
            const now = new Date();
            const formatter = new Intl.DateTimeFormat('en-US', {
                timeZone: timezone,
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });

            document.getElementById('timezonePreview').textContent =
                `Current time in ${timezone}: ${formatter.format(now)}`;
        }

        function showHotelForm(i, add = false) {
            document.getElementById('hotelIndex').value = i;
            document.getElementById('hotelFormTitle').textContent = add ? 'Add Hotel' : 'Edit Hotel';
            const h = hotels[i] || {};
            document.getElementById('hotelName').value = h.name || '';
            document.getElementById('hotelAddress').value = h.address || '';
            document.getElementById('hotelLocation').value = h.location || '';
            document.getElementById('hotelDescription').value = h.description || '';
            document.getElementById('hotelPhone').value = h.phone || '';

            // Reset file selection
            selectedFiles = [];
            document.getElementById('preview').innerHTML = '';
            hideMessages();

            document.getElementById('hotelTableWrapper').style.display = 'none';
            document.getElementById('hotelFormWrapper').style.display = 'block';
        }

        function showAddHotel() {
            showHotelForm(hotels.length, true);
        }

        function hideHotelForm() {
            document.getElementById('hotelFormWrapper').style.display = 'none';
            document.getElementById('hotelTableWrapper').style.display = 'block';
        }

        function saveHotelForm(e) {
            e.preventDefault();
            const i = +document.getElementById('hotelIndex').value;
            const obj = {
                name: document.getElementById('hotelName').value,
                address: document.getElementById('hotelAddress').value,
                location: document.getElementById('hotelLocation').value,
                description: document.getElementById('hotelDescription').value,
                phone: document.getElementById('hotelPhone').value,
                images: selectedFiles.map(file => file.dataUrl)
            };
            if (i >= hotels.length) {
                hotels.push(obj);
                showToast('success', 'Hotel added successfully!');
            } else {
                hotels[i] = obj;
                showToast('success', 'Hotel updated successfully!');
            }
            hideHotelForm();
            loadHotels();
        }

        function deleteHotel() {
            const i = +document.getElementById('hotelIndex').value;
            Swal.fire({
                icon: 'warning',
                title: 'Delete this hotel?',
                text: 'This action cannot be undone.',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then(r => {
                if (r.isConfirmed) {
                    hotels.splice(i, 1);
                    showToast('success', 'Hotel deleted successfully!');
                    hideHotelForm();
                    loadHotels();
                }
            });
        }

        function saveSettings() {
            // Collect all settings
            const newSettings = {
                ccCutoffTime: document.getElementById('ccCutoffTime').value,
                timezone: document.getElementById('timezone').value,
                modules: { ...systemSettings.modules }
            };

            // Simulate API call
            setTimeout(() => {
                systemSettings = newSettings;
                showToast('success', 'Settings saved successfully!');
            }, 500);

            showToast('info', 'Saving settings...');
        }

        function resetSettings() {
            Swal.fire({
                icon: 'warning',
                title: 'Reset to defaults?',
                text: 'This will reset all settings to their default values.',
                showCancelButton: true,
                confirmButtonText: 'Yes, reset',
                cancelButtonText: 'Cancel'
            }).then(result => {
                if (result.isConfirmed) {
                    // Reset to defaults
                    systemSettings = {
                        ccCutoffTime: '19:00',
                        timezone: 'Asia/Colombo',
                        modules: {
                            travelAgency: true,
                            restaurant: true,
                            laundry: false,
                            notifications: true,
                            analytics: true,
                            mobile: false
                        }
                    };
                    initializeSettings();
                    showToast('success', 'Settings reset to defaults!');
                }
            });
        }

        function previewTemplate(templateType) {
            const template = emailTemplates[templateType];
            if (!template) return;

            const sampleData = {
                guestName: 'John Doe',
                bookingRef: 'HTL123456',
                roomType: 'Deluxe Room',
                checkinDate: 'July 15, 2025',
                checkoutDate: 'July 18, 2025',
                totalAmount: '$675.00'
            };

            let emailContent = template.emailContent;
            Object.keys(sampleData).forEach(key => {
                const regex = new RegExp(`{{${key}}}`, 'g');
                emailContent = emailContent.replace(regex, sampleData[key]);
            });

            document.getElementById('templatePreviewContent').innerHTML = emailContent;

            const modal = new bootstrap.Modal(document.getElementById('templatePreviewModal'));
            modal.show();
        }

        function editTemplate(templateType) {
            const template = emailTemplates[templateType];
            if (!template) return;

            document.getElementById('editingTemplateType').value = templateType;
            document.getElementById('templateSubject').value = template.subject;
            document.getElementById('templateEmailContent').value = template.emailContent;
            document.getElementById('templateSmsContent').value = template.smsContent || '';

            updateTemplateLivePreview();

            const modal = new bootstrap.Modal(document.getElementById('templateEditorModal'));
            modal.show();

            // Add live preview listeners
            ['templateSubject', 'templateEmailContent', 'templateSmsContent'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateTemplateLivePreview);
            });
        }

        function updateTemplateLivePreview() {
            const content = document.getElementById('templateEmailContent').value;
            const sampleData = {
                guestName: 'John Doe',
                bookingRef: 'HTL123456',
                roomType: 'Deluxe Room',
                checkinDate: 'July 15, 2025',
                checkoutDate: 'July 18, 2025',
                totalAmount: '$675.00'
            };

            let previewContent = content;
            Object.keys(sampleData).forEach(key => {
                const regex = new RegExp(`{{${key}}}`, 'g');
                previewContent = previewContent.replace(regex, sampleData[key]);
            });

            document.getElementById('templateLivePreview').innerHTML = previewContent || '<p class="text-muted">Start typing to see preview...</p>';
        }

        function insertVariable(variable) {
            const textarea = document.getElementById('templateEmailContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;

            textarea.value = text.substring(0, start) + variable + text.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + variable.length, start + variable.length);

            updateTemplateLivePreview();
        }

        function saveTemplateChanges() {
            const templateType = document.getElementById('editingTemplateType').value;
            const subject = document.getElementById('templateSubject').value;
            const emailContent = document.getElementById('templateEmailContent').value;
            const smsContent = document.getElementById('templateSmsContent').value;

            emailTemplates[templateType].subject = subject;
            emailTemplates[templateType].emailContent = emailContent;
            emailTemplates[templateType].smsContent = smsContent;

            showToast('success', 'Template updated successfully!');

            const modal = bootstrap.Modal.getInstance(document.getElementById('templateEditorModal'));
            modal.hide();
        }

        function testSendTemplate(templateType) {
            Swal.fire({
                title: 'Send Test Email',
                html: `
                    <div class="mb-3">
                        <label for="testEmailAddress" class="form-label">Email Address</label>
                        <input type="email" id="testEmailAddress" class="form-control" placeholder="Enter email address">
                    </div>
                    <div class="mb-3">
                        <label for="testPhoneNumber" class="form-label">Phone Number (for SMS)</label>
                        <input type="tel" id="testPhoneNumber" class="form-control" placeholder="+94771234567">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Send Test',
                preConfirm: () => {
                    const email = document.getElementById('testEmailAddress').value;
                    const phone = document.getElementById('testPhoneNumber').value;
                    if (!email) {
                        Swal.showValidationMessage('Please enter an email address');
                        return false;
                    }
                    return { email, phone };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simulate sending test
                    showToast('info', 'Sending test notifications...');
                    setTimeout(() => {
                        showToast('success', `Test notifications sent to ${result.value.email}${result.value.phone ? ' and ' + result.value.phone : ''}!`);
                    }, 2000);
                }
            });
        }

        function showToast(type, message) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();

            const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;

            toastContainer.insertAdjacentHTML('beforeend', toastHtml);

            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();

            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // Enhanced Drag & Drop functionality (keeping existing code)
        function initializeDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('hotelImages');

            dropZone.addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON') {
                    fileInput.click();
                }
            });

            dropZone.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    fileInput.click();
                }
            });

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', (e) => {
                handleFiles(Array.from(e.target.files));
            });
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            const dropZone = document.getElementById('dropZone');
            dropZone.classList.add('drag-over');
        }

        function unhighlight(e) {
            const dropZone = document.getElementById('dropZone');
            dropZone.classList.remove('drag-over');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = Array.from(dt.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            hideMessages();

            const validFiles = files.filter(file => {
                if (!allowedTypes.includes(file.type)) {
                    showError(`${file.name} is not a valid image type. Please use JPG, PNG, or GIF.`);
                    return false;
                }
                if (file.size > maxFileSize) {
                    showError(`${file.name} is too large. Maximum file size is 5MB.`);
                    return false;
                }
                return true;
            });

            const totalFiles = selectedFiles.length + validFiles.length;
            if (totalFiles > maxFiles) {
                showError(`You can only upload a maximum of ${maxFiles} images. Please remove some files first.`);
                return;
            }

            if (validFiles.length === 0) return;

            validFiles.forEach(file => {
                const fileObj = {
                    file: file,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    dataUrl: null
                };

                const reader = new FileReader();
                reader.onload = (e) => {
                    fileObj.dataUrl = e.target.result;
                    selectedFiles.push(fileObj);
                    updatePreview();

                    if (selectedFiles.length === 1) {
                        showSuccess('Images uploaded successfully!');
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function updatePreview() {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';

            selectedFiles.forEach((fileObj, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'file-preview';

                previewDiv.innerHTML = `
                <img src="${fileObj.dataUrl}" alt="Preview of ${fileObj.name}">
                <button type="button" class="file-remove" onclick="removeFile(${index})" title="Remove image" aria-label="Remove ${fileObj.name}">
                    <i class="fas fa-times"></i>
                </button>
                <div class="file-type-indicator">${fileObj.type.split('/')[1]}</div>
                <div class="file-info">${fileObj.name} (${formatFileSize(fileObj.size)})</div>
            `;

                preview.appendChild(previewDiv);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updatePreview();
            hideMessages();

            if (selectedFiles.length === 0) {
                showSuccess('All images removed.');
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }
    </script>
</body>

</html>